var Delorean=Class.create({initialize:function(b,c,a){if(!$(b)){throw new Error("Element does not exist: "+b)}this.options={stroke:"1px",color:"#666",padding:20,height:20,start:null,finish:null,dateFormat:"d M Y",text:{size:9,weight:"bold",font:"Helvetica",color:"#333"}};this.extendOptions(this.options,a||{});if(Object.isNumber(this.options.padding)){this.options.padding={top:this.options.padding,right:this.options.padding,left:this.options.padding,bottom:this.options.padding}}this.dates=c.sort(function(e,d){return e.date-d.date});this.start=this.options.start||this.dates.first().date;this.finish=this.options.finish||this.dates.last().date;this.paper=Raphael(b);this.width=parseFloat($(b).getWidth());this.height=parseFloat($(b).getHeight());this.plotMarkers();this.drawTimeLine()},extendOptions:function(a,c){var b,d;for(b in c){if(Object.values(a[b]).length>0&&Object.values(c[b]).length>0){for(d in c[b]){a[b][d]=c[b][d]}}else{a[b]=c[b]}}return a},drawTimeLine:function(){this.timeline=this.paper.path("M"+this.startPos+" "+(this.height/2)+"L"+this.finishPos+" "+(this.height/2));this.timeline.attr("stroke",this.options.color)},plotMarkers:function(){var b=this.paper.set(),h,i,g=((this.height/2)-(this.options.height/2)),f=((this.height/2)+(this.options.height/2)),e=(this.finish-this.start),a,d=false,c;start=this.drawLabel(this.options.padding.left,g,this.dates.first(),d);finish=this.drawLabel(this.width-this.options.padding.right,(this.dates.length%2==0)?f:g,this.dates.last(),(this.dates.length%2==0));startBox=start.getBBox();finishBox=finish.getBBox();this.startPos=Math.round((startBox.x+(startBox.width/2)));this.finishPos=Math.round((finishBox.x+(finishBox.width/2)));a=e/(this.finishPos-this.startPos);this.dates.each(function(k,j){i=this.startPos+Math.round(((k.date-this.start)/a));c=(d)?f:g;b.push(this.paper.path("M"+i+" "+g+"L"+i+" "+f));b[j].attr("stroke",k.color||this.options.color);if(j!=0&&j!=this.dates.length-1){h=this.drawLabel(i,c,k,d)}d=!d},this)},drawLabel:function(a,d,b,c){labelTxt=this.formatDate(b.date,this.options.dateFormat)+"\n"+b.label;label=this.paper.text(a,d,labelTxt).attr({fill:b.textColor||this.options.text.color,"text-anchor":"middle","font-size":this.options.text.size,"font-weight":this.options.text.weight,"font-family":this.options.text.font});lBox=label.getBBox();label.translate(0,Math.round((c?(lBox.height/2)+2:-((lBox.height/2)+2))));if(lBox.x<this.options.padding.left){label.attr("x",this.options.padding.left+(lBox.width/2))}else{if((lBox.x+lBox.width)>(this.width-this.options.padding.right)){label.attr("x",(this.width-this.options.padding.right)-(lBox.width/2))}}return label},formatDate:function(b,c){var a=["January","February","March","April","May","June","July","August","September","October","November","December"],d=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];switch(c){case"d/m/Y":return b.getDate()+"/"+b.getMonth()+"/"+b.getYear();break;case"m/d/Y":return b.getMonth()+"/"+b.getDate()+"/"+b.getYear();break;case"Y-m-d":return b.getFullYear()+"-"+b.getMonth()+"/"+b.getDate();break;case"d M Y":return b.getDate()+" "+a[b.getMonth()].substr(0,3)+" "+b.getFullYear();break;case"d F Y":return b.getDate()+" "+a[b.getMonth()]+" "+b.getFullYear();break;case"D d M y":return d[b.getDaydate.getDate()].substr(0,3)+" "+a[b.getMonth()].substr(0,3)+" "+b.getFullYear().substr(2);break;case"l d M y":return d[b.getDaydate.getDate()]+" "+a[b.getMonth()].substr(0,3)+" "+b.getFullYear().substr(2);break;case"l d F y":return d[b.getDaydate.getDate()]+" "+a[b.getMonth()]+" "+b.getFullYear().substr(2);break;default:return b}}});